

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example tag compliance policy &mdash; Cloud Custodian  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/c1_labs.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/css/expand.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Cloud Custodian  documentation" href="../index.html"/>
        <link rel="next" title="Use Cases" href="../usecases/index.html"/>
        <link rel="prev" title="Example offhours policy" href="offhours.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Cloud Custodian
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Monitoring your environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Usage</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="offhours.html">Example offhours policy</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example tag compliance policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usecases/index.html">Use Cases</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AWS Lambda</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../policy/lambda.html">Lambda Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policy/mu.html">Mu - Lambda Lifecycle Management</a></li>
</ul>
<p class="caption"><span class="caption-text">Policies reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../policy/index.html">Resource-Specific Filters and Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters.html">Generic Filters</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contributing to Cloud Custodian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/installing.html">Installing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/tests.html">Testing for Developers</a></li>
</ul>
<p class="caption"><span class="caption-text">Azure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../azure/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/usecases/index.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/policy/index.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/multiplesubs.html">Multiple Subscriptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/contribute.html">Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../generated/aws/modules.html">AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../generated/azure/modules.html">Azure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../generated/gcp/modules.html">GCP</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cloud Custodian</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Example tag compliance policy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="example-tag-compliance-policy">
<span id="tagcompliance"></span><h1>Example tag compliance policy<a class="headerlink" href="#example-tag-compliance-policy" title="Permalink to this headline">¶</a></h1>
<p>In this sample policy we are filtering for EC2
instances that are: running, not part of an Auto Scaling Group (ASG), not
already marked for an operation, have less than 10 tags, and are missing one or more
of the required tags. Once Custodian has filtered the list, it will
mark all EC2 instances that match the above criteria with a tag. That tag specifies an action
that will take place at a certain time. This policy is one of three that
are needed to manage tag compliance. The other two policies in this set are, 1)
checking to see if the tags have been corrected before the four day period
is up, and 2) performing the operation of stopping all instances
with the status to be stopped on that particular day.</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-tag-compliance-mark</span>
  <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
  <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
    <span class="no">Mark non-compliant, Non-ASG EC2 instances with stoppage in 4 days</span>
  <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">▣───────── - &quot;State.Name&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">running</span>
<span class="l l-Scalar l-Scalar-Plain">│ ▣─────── - &quot;tag:aws:autoscaling:groupName&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ ▣───── - &quot;tag:c7n_status&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │ ▣─── - type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tag-count</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │ │    - or</span><span class="p p-Indicator">:</span>                           <span class="l l-Scalar l-Scalar-Plain">─┐</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │ │      - &quot;tag:Owner&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent          ├─If any of these tags are</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │ │      - &quot;tag:CostCenter&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent     │ missing, then select instance</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │ │      - &quot;tag:Project&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent       ─┘</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │ │</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │ │  actions</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">─────────────────▶ For selected instances, run this action</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │ │    - type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mark-for-op ────▶ Mark instance for operation</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │ │      op</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">stop ─────────────▶ Stop instance</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │ │      days</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4 ──────────────▶ After 4 days</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │ │</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │ ▣────▶ If instance has 10 tags, skip</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ ▣──────▶ If instance already has a c7n_status, skip</span>
<span class="l l-Scalar l-Scalar-Plain">│ ▣────────▶ If instance is part of an ASG, skip</span>
<span class="l l-Scalar l-Scalar-Plain">▣──────────▶ If instance is not running, skip</span>
</pre></div>
</td></tr></table></div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../usecases/index.html" class="btn btn-neutral float-right" title="Use Cases" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="offhours.html" class="btn btn-neutral" title="Example offhours policy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Capital One Services, LLC.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/js/expand.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>