Azure Common Filters
====================

Filters


   - :ref:`active-key-name <Azure.common.filters.active-key-name>`


   - :ref:`auto-regenerate-key <Azure.common.filters.auto-regenerate-key>`


   - :ref:`configuration <Azure.common.filters.configuration>`


   - :ref:`cost <Azure.common.filters.cost>`


   - :ref:`diagnostic-settings <Azure.common.filters.diagnostic-settings>`


   - :ref:`event <Azure.common.filters.event>`


   - :ref:`firewall-rules <Azure.common.filters.firewall-rules>`


   - :ref:`instance-view <Azure.common.filters.instance-view>`


   - :ref:`marked-for-op <Azure.common.filters.marked-for-op>`


   - :ref:`metric <Azure.common.filters.metric>`


   - :ref:`offer <Azure.common.filters.offer>`


   - :ref:`offhour <Azure.common.filters.offhour>`


   - :ref:`onhour <Azure.common.filters.onhour>`


   - :ref:`parent <Azure.common.filters.parent>`


   - :ref:`policy-compliant <Azure.common.filters.policy-compliant>`


   - :ref:`regeneration-period <Azure.common.filters.regeneration-period>`


   - :ref:`resource-lock <Azure.common.filters.resource-lock>`


   - :ref:`storage-diagnostic-settings <Azure.common.filters.storage-diagnostic-settings>`


   - :ref:`value <Azure.common.filters.value>`




.. _Azure.common.filters.active-key-name:

active-key-name
+++++++++++++++

Filter Key Vault Managed Storage Account Resource on Active Key Name property.

This is ``Value`` based filter, you can provide string ``value`` property.

``value_type`` is always ``normalize``.

:example:

List all Key Vault managed Storage Accounts with Active Key Name key1

.. code-block:: yaml

    policies:
      - name: keyvault-storage-active-key-name
        resource: azure.keyvault-storage
        filters:
          - type: active-key-name
            value: key1

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key: null
      op: null
      type:
        enum:
        - active-key-name
      value:
        type: string
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type: null
    required:
    - value
    - type



.. _Azure.common.filters.auto-regenerate-key:

auto-regenerate-key
+++++++++++++++++++

Filter Key Vault Managed Storage Account Resource on Auto Regenerate property.

This is ``Value`` based filter, you can provide boolean ``value`` property.

:example:

List all Key Vault managed Storage Accounts with disabled automatic keys regeneration

.. code-block:: yaml

    policies:
      - name: keyvault-storage-auto-regenerate
        resource: azure.keyvault-storage
        filters:
          - type: auto-regenerate-key
            value: False

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key: null
      op: null
      type:
        enum:
        - auto-regenerate-key
      value:
        type: boolean
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type: null
    required:
    - type



.. _Azure.common.filters.configuration:

configuration
+++++++++++++



.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - configuration
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type



.. _Azure.common.filters.cost:

cost
++++

Filter resources by the cost consumed over a timeframe.

Total cost for the resource includes costs for all of it child resources if billed
separately (e.g. SQL Server and SQL Server Databases). Warning message is logged if we detect
different currencies.

Timeframe options:

  - Number of days before today

  - All days in current calendar period until today:

    - ``WeekToDate``
    - ``MonthToDate``
    - ``YearToDate``

  - All days in the previous calendar period:

    - ``TheLastWeek``
    - ``TheLastMonth``
    - ``TheLastYear``

:examples:

SQL servers that were cost more than 2000 in the last month.

.. code-block:: yaml

        policies:
            - name: expensive-sql-servers-last-month
              resource: azure.sqlserver
              filters:
              - type: cost
                timeframe: TheLastMonth
                op: gt
                value: 2000

SQL servers that were cost more than 2000 in the last 30 days not including today.

.. code-block:: yaml

        policies:
            - name: expensive-sql-servers
              resource: azure.sqlserver
              filters:
              - type: cost
                timeframe: 30
                op: gt
                value: 2000

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key: null
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      timeframe:
        oneOf:
        - enum:
          - WeekToDate
          - MonthToDate
          - YearToDate
          - TheLastWeek
          - TheLastMonth
          - TheLastYear
        - minimum: 1
          type: number
      type:
        enum:
        - cost
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - timeframe
    - type



.. _Azure.common.filters.diagnostic-settings:

diagnostic-settings
+++++++++++++++++++

The diagnostic settings filter is implicitly just the ValueFilter
on the diagnostic settings for an azure resource.

:example:

Find Load Balancers that have logs for both LoadBalancerProbeHealthStatus category and
LoadBalancerAlertEvent category enabled.
The use of value_type: swap is important for these examples because it swaps the value
and the evaluated key so that it evaluates the value provided is in the logs.

.. code-block:: yaml

    policies
      - name: find-load-balancers-with-logs-enabled
        resource: azure.loadbalancer
        filters:
          - type: diagnostic-settings
            key: logs[?category == 'LoadBalancerProbeHealthStatus'][].enabled
            value: True
            op: in
            value_type: swap
          - type: diagnostic-settings
            key: logs[?category == 'LoadBalancerAlertEvent'][].enabled
            value: True
            op: in
            value_type: swap

:example:

Find KeyVaults that have logs enabled for the AuditEvent category.

.. code-block:: yaml

    policies
      - name: find-keyvaults-with-logs-enabled
        resource: azure.keyvault
        filters:
          - type: diagnostic-settings
            key: logs[?category == 'AuditEvent'][].enabled
            value: True
            op: in
            value_type: swap

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - diagnostic-settings
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type



.. _Azure.common.filters.event:

event
+++++

Filter a resource based on an event.

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - event
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type



.. _Azure.common.filters.firewall-rules:

firewall-rules
++++++++++++++

Filters resources by the firewall rules

Rules can be specified as x.x.x.x-y.y.y.y or x.x.x.x or x.x.x.x/y.

With the exception of **equal** all modes reference total IP space and ignore
specific notation.

**include**: True if all IP space listed is included in firewall.

**any**: True if any overlap in IP space exists.

**only**: True if firewall IP space only includes IPs from provided space
(firewall is subset of provided space).

**equal**: the list of IP ranges or CIDR that firewall rules must match exactly.

**IMPORTANT**: this filter ignores all bypass rules. If you want to ensure your resource is
not available for other Azure Cloud services or from the Portal, please use ``firewall-bypass``
filter.

:example:

.. code-block:: yaml

        policies:
            - name: servers-with-firewall
              resource: azure.sqlserver
              filters:
                  - type: firewall-rules
                    include:
                        - '131.107.160.2-131.107.160.3'
                        - 10.20.20.0/24

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    oneOf:
    - required:
      - type
      - include
    - required:
      - type
      - any
    - required:
      - type
      - only
    - required:
      - type
      - equal
    properties:
      any:
        items:
          type: string
        type: array
      equal:
        items:
          type: string
        type: array
      include:
        items:
          type: string
        type: array
      only:
        items:
          type: string
        type: array
      type:
        enum:
        - firewall-rules



.. _Azure.common.filters.instance-view:

instance-view
+++++++++++++



.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - instance-view
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type



.. _Azure.common.filters.marked-for-op:

marked-for-op
+++++++++++++

Filter resources for tag specified future action

Filters resources by a 'custodian_status' tag which specifies a future
date for an action.

The filter parses the tag values looking for an 'op@date'
string. The date is parsed and compared to do today's date, the
filter succeeds if today's date is gte to the target date.

The optional 'skew' parameter provides for incrementing today's
date a number of days into the future. An example use case might
be sending a final notice email a few days before terminating an
instance, or snapshotting a volume prior to deletion.

The optional 'skew_hours' parameter provides for incrementing the current
time a number of hours into the future.

Optionally, the 'tz' parameter can get used to specify the timezone
in which to interpret the clock (default value is 'utc')

:example:

.. code-block :: yaml

   policies:
    - name: vm-stop-marked
      resource: azure.vm
      filters:
        - type: marked-for-op
          # The default tag used is custodian_status
          # but that is configurable
          tag: custodian_status
          op: stop
          # Another optional tag is skew
          tz: utc

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      op:
        type: string
      skew:
        minimum: 0
        type: number
      skew_hours:
        minimum: 0
        type: number
      tag:
        type: string
      type:
        enum:
        - marked-for-op
      tz:
        type: string
    required:
    - type



.. _Azure.common.filters.metric:

metric
++++++

CosmosDB Collection Metric Filter

:example:

This policy will find cosmos db collections with less than 1000 requests per day

.. code-block:: yaml

    policies:
      - name: low-request-collections
        description: |
          get collections with less than 1000 requests per day
        resource: azure.cosmosdb-database
        filters:
          - type: metric
            metric: TotalRequestUnits
            op: le
            aggregation: average
            interval: P1D
            threshold: 1000
            timeframe: 72

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      aggregation:
        enum:
        - total
        - average
        - count
        - minimum
        - maximum
      filter:
        type: string
      interval:
        enum:
        - PT1M
        - PT5M
        - PT15M
        - PT30M
        - PT1H
        - PT6H
        - PT12H
        - P1D
      metric:
        type: string
      no_data_action:
        enum:
        - include
        - exclude
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
      threshold:
        type: number
      timeframe:
        type: number
      type:
        enum:
        - metric
    required:
    - type
    - metric
    - op
    - threshold



.. _Azure.common.filters.offer:

offer
+++++

CosmosDB Offer Filter

Allows access to the offer on a collection or database.

:example:

This policy will find all collections with a V2 offer which indicates
throughput is provisioned at the collection scope.

.. code-block:: yaml

    policies:
      - name: cosmosdb-collection-high-throughput
        resource: azure.cosmosdb-collection
        filters:
          - type: offer
            key: offerVersion
            op: eq
            value: 'V2'

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - offer
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type



.. _Azure.common.filters.offhour:

offhour
+++++++

Schedule offhours for resources see :ref:`offhours <offhours>`
for features and configuration.

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default_tz:
        type: string
      offhour:
        maximum: 23
        minimum: 0
        type: integer
      opt-out:
        type: boolean
      skip-days:
        items:
          pattern: ^[0-9]{4}-[0-9]{2}-[0-9]{2}
          type: string
        type: array
      skip-days-from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      tag:
        type: string
      type:
        enum:
        - offhour
      weekends:
        type: boolean
      weekends-only:
        type: boolean
    required:
    - offhour
    - default_tz
    - type



.. _Azure.common.filters.onhour:

onhour
++++++

Schedule offhours for resources see :ref:`offhours <offhours>`
for features and configuration.

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default_tz:
        type: string
      onhour:
        maximum: 23
        minimum: 0
        type: integer
      opt-out:
        type: boolean
      skip-days:
        items:
          pattern: ^[0-9]{4}-[0-9]{2}-[0-9]{2}
          type: string
        type: array
      skip-days-from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      tag:
        type: string
      type:
        enum:
        - onhour
      weekends:
        type: boolean
      weekends-only:
        type: boolean
    required:
    - onhour
    - default_tz
    - type



.. _Azure.common.filters.parent:

parent
++++++

Meta filter that allows you to filter child resources by applying filters to their
parent resources.

You can use any filter supported by corresponding parent resource type.

:examples:

Find Azure KeyVault Keys from Key Vaults with ``owner:ProjectA`` tag.

.. code-block:: yaml

    policies:
      - name: kv-keys-from-tagged-keyvaults
        resource: azure.keyvault-key
        filters:
          - type: parent
            filter:
              type: value
              key: tags.owner
              value: ProjectA

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      filter:
        type: object
      type:
        enum:
        - parent
    required:
    - type
    - type



.. _Azure.common.filters.policy-compliant:

policy-compliant
++++++++++++++++

Filter resources based on Azure Policy compliance status

Filter resources by their current Azure Policy compliance status.

You can specify if you want to filter compliant or non-compliant resources.

You can provide a list of Azure Policy definitions display names or names to limit
amount of non-compliant resources. By default it returns a list of all non-compliant
resources.

.. code-block :: yaml

   policies:
    - name: non-compliant-vms
      resource: azure.vm
      filters:
        - type: policy-compliant
          compliant: false
          definitions:
            - "Definition display name 1"
            - "Definition display name 2"

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      compliant:
        type: boolean
      definitions:
        type: array
      type:
        enum:
        - policy-compliant
    required:
    - type
    - compliant
    - type



.. _Azure.common.filters.regeneration-period:

regeneration-period
+++++++++++++++++++

Filter Key Vault Managed Storage Account Resource on Regeneration Period property.

This is ``Value`` based filter, you can provide any ``value`` and ``op`` properties.

:example:

List all Key Vault managed Storage Accounts with regeneration period not equal to P90D

.. code-block:: yaml


    policies:
      - name: keyvault-storage-regeneration-period
        resource: azure.keyvault-storage
        filters:
          - type: regeneration-period
            op: ne
            value: P90D

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key: null
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - regeneration-period
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type: null
    required:
    - type



.. _Azure.common.filters.resource-lock:

resource-lock
+++++++++++++

Filter locked resources.
Lock can be of 2 types: ReadOnly and CanNotDelete. To filter any lock, use "Any" type.
Lock type is optional, by default any lock will be applied to the filter.
To get unlocked resources, use "Absent" type.

:example:

Get all keyvaults with ReadOnly lock:

.. code-block :: yaml

   policies:
    - name: locked-keyvaults
      resource: azure.keyvault
      filters:
        - type: resource-lock
          lock-type: ReadOnly

:example:

Get all locked sqldatabases (any type of lock):

.. code-block :: yaml

   policies:
    - name: locked-sqldatabases
      resource: azure.sqldatabase
      filters:
        - type: resource-lock

:example:

Get all unlocked resource groups:

.. code-block :: yaml

   policies:
    - name: unlock-rgs
      resource: azure.resourcegroup
      filters:
        - type: resource-lock
          lock-type: Absent

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      lock-type:
        enum:
        - ReadOnly
        - CanNotDelete
        - Any
        - Absent
      type:
        enum:
        - resource-lock
    required:
    - type
    - type



.. _Azure.common.filters.storage-diagnostic-settings:

storage-diagnostic-settings
+++++++++++++++++++++++++++

Filters storage accounts based on its diagnostic settings. The filter requires
specifying the storage type (blob, queue, table, file) and will filter based on
the settings for that specific type.

 :example:

    Find all storage accounts that have a 'delete' logging setting disabled.

 .. code-block:: yaml

    policies:
        - name: find-accounts-with-delete-logging-disabled
          resource: azure.storage
          filters:
            - or:
                - type: storage-diagnostic-settings
                  storage-type: blob
                  key: logging.delete
                  op: eq
                  value: False
                - type: storage-diagnostic-settings
                  storage-type: queue
                  key: logging.delete
                  op: eq
                  value: False
                - type: storage-diagnostic-settings
                  storage-type: table
                  key: logging.delete
                  op: eq
                  value: False

:example:

Find Load Balancers that have logs for both LoadBalancerProbeHealthStatus
category and LoadBalancerAlertEvent category enabled.
The use of value_type: swap is important for these examples because it swaps
the value and the evaluated key so that it evaluates the value provided is in the logs.

.. code-block:: yaml

    policies
      - name: find-load-balancers-with-logs-enabled
        resource: azure.loadbalancer
        filters:
          - type: diagnostic-settings
            key: logs[?category == 'LoadBalancerProbeHealthStatus'][].enabled
            value: True
            op: in
            value_type: swap
          - type: diagnostic-settings
            key: logs[?category == 'LoadBalancerAlertEvent'][].enabled
            value: True
            op: in
            value_type: swap

:example:

Find KeyVaults that have logs enabled for the AuditEvent category.

.. code-block:: yaml

    policies
      - name: find-keyvaults-with-logs-enabled
        resource: azure.keyvault
        filters:
          - type: diagnostic-settings
            key: logs[?category == 'AuditEvent'][].enabled
            value: True
            op: in
            value_type: swap

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      storage-type:
        enum:
        - blob
        - queue
        - table
        - file
        type: string
      type:
        enum:
        - storage-diagnostic-settings
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - storage-type
    - type



.. _Azure.common.filters.value:

value
+++++

Generic value filter using jmespath
    

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - value
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type


