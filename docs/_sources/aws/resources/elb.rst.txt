.. _aws.elb:

aws.elb
=======



Filters
-------


  - :ref:`config-compliance <aws.common.filters.config-compliance>`
  
  - :ref:`default-vpc <aws.elb.filters.default-vpc>`

  - :ref:`event <aws.common.filters.event>`
  
  - :ref:`finding <aws.common.filters.finding>`
  
  - :ref:`health-event <aws.common.filters.health-event>`
  
  - :ref:`healthcheck-protocol-mismatch <aws.elb.filters.healthcheck-protocol-mismatch>`

  - :ref:`instance <aws.elb.filters.instance>`

  - :ref:`is-logging <aws.elb.filters.is-logging>`

  - :ref:`is-not-logging <aws.elb.filters.is-not-logging>`

  - :ref:`is-ssl <aws.elb.filters.is-ssl>`

  - :ref:`marked-for-op <aws.common.filters.marked-for-op>`
  
  - :ref:`metrics <aws.common.filters.metrics>`
  
  - :ref:`network-location <aws.common.filters.network-location>`
  
  - :ref:`ops-item <aws.common.filters.ops-item>`
  
  - :ref:`security-group <aws.common.filters.security-group>`
  
  - :ref:`shield-enabled <aws.elb.filters.shield-enabled>`

  - :ref:`shield-metrics <aws.common.filters.shield-metrics>`
  
  - :ref:`ssl-policy <aws.elb.filters.ssl-policy>`

  - :ref:`subnet <aws.common.filters.subnet>`
  
  - :ref:`tag-count <aws.common.filters.tag-count>`
  
  - :ref:`value <aws.common.filters.value>`
  
  - :ref:`vpc <aws.common.filters.vpc>`
  


.. _aws.elb.filters.default-vpc:

default-vpc
+++++++++++
Matches if an elb database is in the default vpc

:example:

.. code-block:: yaml

        policies:
          - name: elb-default-vpc
            resource: elb
            filters:
              - type: default-vpc

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      type:
        enum:
        - default-vpc
    required:
    - type


.. _aws.elb.filters.healthcheck-protocol-mismatch:

healthcheck-protocol-mismatch
+++++++++++++++++++++++++++++
Filters ELB that have a healtch check protocol mismatch

The mismatch occurs if the ELB has a different protocol to check than
the associated instances allow to determine health status.

:example:

.. code-block:: yaml

        policies:
          - name: elb-healthcheck-mismatch
            resource: elb
            filters:
              - type: healthcheck-protocol-mismatch

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      type:
        enum:
        - healthcheck-protocol-mismatch
    required:
    - type


.. _aws.elb.filters.instance:

instance
++++++++
Filter ELB by an associated instance value(s)

:example:

.. code-block:: yaml

        policies:
          - name: elb-image-filter
            resource: elb
            filters:
              - type: instance
                key: ImageId
                value: ami-01ab23cd

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      default:
        type: object
      key:
        type: string
      op:
        enum:
        - eq
        - equal
        - ne
        - not-equal
        - gt
        - greater-than
        - ge
        - gte
        - le
        - lte
        - lt
        - less-than
        - glob
        - regex
        - regex-case
        - in
        - ni
        - not-in
        - contains
        - difference
        - intersect
      type:
        enum:
        - instance
      value:
        oneOf:
        - type: array
        - type: string
        - type: boolean
        - type: number
        - type: 'null'
      value_from:
        additionalProperties: 'False'
        properties:
          expr:
            oneOf:
            - type: integer
            - type: string
          format:
            enum:
            - csv
            - json
            - txt
            - csv2dict
          url:
            type: string
        required:
        - url
        type: object
      value_regex:
        type: string
      value_type:
        enum:
        - age
        - integer
        - expiration
        - normalize
        - size
        - cidr
        - cidr_size
        - swap
        - resource_count
        - expr
        - unique_size
        - date
        - version
    required:
    - type


.. _aws.elb.filters.is-logging:

is-logging
++++++++++
Matches ELBs that are logging to S3.
    bucket and prefix are optional

:example:

.. code-block:: yaml

        policies:
        - name: elb-is-logging-test
          resource: elb
          filters:
            - type: is-logging

        - name: elb-is-logging-bucket-and-prefix-test
          resource: elb
          filters:
            - type: is-logging
              bucket: prodlogs
              prefix: elblogs

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      bucket:
        type: string
      prefix:
        type: string
      type:
        enum:
        - is-logging
    required:
    - type


.. _aws.elb.filters.is-not-logging:

is-not-logging
++++++++++++++
Matches ELBs that are NOT logging to S3.
    or do not match the optional bucket and/or prefix.

:example:

.. code-block:: yaml

        policies:
            - name: elb-is-not-logging-test
              resource: elb
              filters:
                - type: is-not-logging

            - name: is-not-logging-bucket-and-prefix-test
              resource: app-elb
              filters:
                - type: is-not-logging
                  bucket: prodlogs
                  prefix: alblogs

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      bucket:
        type: string
      prefix:
        type: string
      type:
        enum:
        - is-not-logging
    required:
    - type


.. _aws.elb.filters.is-ssl:

is-ssl
++++++
Filters ELB that are using a SSL policy

:example:

.. code-block:: yaml

        policies:
          - name: elb-using-ssl
            resource: elb
            filters:
              - type: is-ssl

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      type:
        enum:
        - is-ssl
    required:
    - type


.. _aws.elb.filters.shield-enabled:

shield-enabled
++++++++++++++


.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      state:
        type: boolean
      type:
        enum:
        - shield-enabled
    required:
    - type


.. _aws.elb.filters.ssl-policy:

ssl-policy
++++++++++
Filter ELBs on the properties of SSLNegotation policies.
TODO: Only works on custom policies at the moment.

whitelist: filter all policies containing permitted protocols
blacklist: filter all policies containing forbidden protocols

Cannot specify both whitelist & blacklist in the same policy. These must
be done seperately (seperate policy statements).

Likewise, if you want to reduce the consideration set such that we only
compare certain keys (e.g. you only want to compare the `Protocol-` keys),
you can use the `matching` option with a regular expression:

:example:

.. code-block:: yaml

        policies:
          - name: elb-ssl-policies
            resource: elb
            filters:
              - type: ssl-policy
                blacklist:
                    - "Protocol-SSLv2"
                    - "Protocol-SSLv3"
          - name: elb-modern-tls
            resource: elb
            filters:
              - type: ssl-policy
                matching: "^Protocol-"
                whitelist:
                    - "Protocol-TLSv1.1"
                    - "Protocol-TLSv1.2"

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    oneOf:
    - required:
      - type
      - whitelist
    - required:
      - type
      - blacklist
    properties:
      blacklist:
        items:
          type: string
        type: array
      matching:
        type: string
      type:
        enum:
        - ssl-policy
      whitelist:
        items:
          type: string
        type: array




Actions
-------


  - :ref:`auto-tag-user <aws.common.actions.auto-tag-user>`
  
  - :ref:`delete <aws.elb.actions.delete>`

  - :ref:`disable-s3-logging <aws.elb.actions.disable-s3-logging>`

  - :ref:`enable-s3-logging <aws.elb.actions.enable-s3-logging>`

  - :ref:`invoke-lambda <aws.common.actions.invoke-lambda>`
  
  - :ref:`invoke-sfn <aws.common.actions.invoke-sfn>`
  
  - :ref:`mark-for-op <aws.common.actions.mark-for-op>`
  
  - :ref:`modify-security-groups <aws.common.actions.modify-security-groups>`
  
  - :ref:`notify <aws.common.actions.notify>`
  
  - :ref:`post-finding <aws.common.actions.post-finding>`
  
  - :ref:`post-item <aws.common.actions.post-item>`
  
  - :ref:`put-metric <aws.common.actions.put-metric>`
  
  - :ref:`remove-tag <aws.common.actions.remove-tag>`
  
  - :ref:`set-shield <aws.elb.actions.set-shield>`

  - :ref:`set-ssl-listener-policy <aws.elb.actions.set-ssl-listener-policy>`

  - :ref:`tag <aws.common.actions.tag>`
  
  - :ref:`webhook <aws.common.actions.webhook>`
  



.. _aws.elb.actions.delete:

delete
++++++
Action to delete ELB(s)

It is recommended to apply a filter to the delete policy to avoid unwanted
deletion of any load balancers.

:example:

.. code-block:: yaml

        policies:
          - name: elb-delete-unused
            resource: elb
            filters:
              - Instances: []
            actions:
              - delete

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      type:
        enum:
        - delete
    required:
    - type


.. _aws.elb.actions.disable-s3-logging:

disable-s3-logging
++++++++++++++++++
Disable s3 logging for ElasticLoadBalancers.

:example:

.. code-block:: yaml

        policies:
          - name: turn-off-elb-logs
            resource: elb
            filters:
              - type: is-logging
                bucket: prodbucket
            actions:
              - type: disable-s3-logging

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      type:
        enum:
        - disable-s3-logging
    required:
    - type


.. _aws.elb.actions.enable-s3-logging:

enable-s3-logging
+++++++++++++++++
Action to enable S3 logging for Elastic Load Balancers.

:example:

.. code-block:: yaml

        policies:
          - name: elb-test
            resource: elb
            filters:
              - type: is-not-logging
            actions:
              - type: enable-s3-logging
                bucket: elblogtest
                prefix: dahlogs
                emit_interval: 5

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      bucket:
        type: string
      emit_interval:
        type: integer
      prefix:
        type: string
      type:
        enum:
        - enable-s3-logging
    required:
    - type


.. _aws.elb.actions.set-shield:

set-shield
++++++++++
Enable shield protection on applicable resource.

setting `sync` parameter will also clear out stale shield protections
for resources that no longer exist.

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      state:
        type: boolean
      sync:
        type: boolean
      type:
        enum:
        - set-shield
    required:
    - type


.. _aws.elb.actions.set-ssl-listener-policy:

set-ssl-listener-policy
+++++++++++++++++++++++
Action to set the ELB SSL listener policy

:example:

.. code-block:: yaml

        policies:
          - name: elb-set-listener-policy
            resource: elb
            actions:
              - type: set-ssl-listener-policy
                name: SSLNegotiation-Policy-01
                attributes:
                  - Protocol-SSLv3
                  - Protocol-TLSv1.1
                  - DHE-RSA-AES256-SHA256

.. container:: toggle

  

  .. raw:: html
     
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      attributes:
        items:
          type: string
        type: array
      name:
        type: string
      type:
        enum:
        - set-ssl-listener-policy
    required:
    - name
    - attributes
    - type

