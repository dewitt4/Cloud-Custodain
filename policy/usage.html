

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Usage &mdash; Cloud Custodian 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/c1_labs.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Cloud Custodian 1.0 documentation" href="../index.html"/>
        <link rel="up" title="Policy" href="index.html"/>
        <link rel="next" title="Amazon Machine Images (AMI)" href="resources/ami.html"/>
        <link rel="prev" title="Value Filters" href="filters.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Cloud Custodian
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Quickstart</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usecases/index.html">Use Cases</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Policy</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#sample-policy">Sample Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#terms">Terms</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#real-time-policies">Real-time Policies</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#filters">Filters</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="filters.html">Value Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.html#jmespath-filter">JMESPath Filter</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#module-c7n.offhours">Offhours</a></li>
<li class="toctree-l4"><a class="reference internal" href="#outputs">Outputs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#resources-and-actions">Resources and Actions</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Cloud Custodian</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Policy</a> &raquo;</li>
      
    <li>Usage</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="usage">
<span id="id1"></span><h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-c7n.offhours">
<span id="offhours"></span><h2>Offhours<a class="headerlink" href="#module-c7n.offhours" title="Permalink to this headline">¶</a></h2>
<div class="section" id="resource-scheduling-offhours">
<h3>Resource Scheduling Offhours<a class="headerlink" href="#resource-scheduling-offhours" title="Permalink to this headline">¶</a></h3>
<p>Custodian provides for time based filters, that allow for taking periodic
action on a resource, with resource schedule customization based on tag values.
A common use is offhours scheduling for asgs, and instances.</p>
</div>
<div class="section" id="features">
<h3>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Flexible offhours scheduling with opt-in, opt-out selection, and timezone
support.</li>
<li>Resume during offhours support.</li>
<li>Can be combined with other filters to get a particular set (
resources with tag, vpc, etc).</li>
<li>Can be combined with arbitrary actions</li>
</ul>
</div>
<div class="section" id="policy-configuration">
<h3>Policy Configuration<a class="headerlink" href="#policy-configuration" title="Permalink to this headline">¶</a></h3>
<p>We provide an <cite>onhour</cite> and <cite>offhour</cite> time filter, each should be used in a
different policy, they support the same configuration options</p>
<blockquote>
<div><ul>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">weekends:</th><td class="field-body">default true, whether to leave resources off for the weekend</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">weekend-only:</th><td class="field-body">default false, whether to turn the resource off only on the</td>
</tr>
</tbody>
</table>
<p>weekend</p>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">default_tz:</th><td class="field-body">which tz to utilize when evaluating time</td>
</tr>
</tbody>
</table>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">tag:</th><td class="field-body">default maid_offhours, which resource tag key to look for the</td>
</tr>
</tbody>
</table>
<p>resource&#8217;s schedule.</p>
</li>
<li><table class="first docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">opt-out:</th><td class="field-body">applies the default schedule to resource which do not specify</td>
</tr>
</tbody>
</table>
<p>any value. a value of <cite>off</cite> to disable/exclude the resource.</p>
</li>
</ul>
</div></blockquote>
<p>The default off hours and on hours are specified per the policy configuration
along with the opt-in/opt-out behavior. Resources can specify the timezone
that they wish to have this scheduled utilized with:</p>
</div>
<div class="section" id="tag-based-configuration">
<h3>Tag Based Configuration<a class="headerlink" href="#tag-based-configuration" title="Permalink to this headline">¶</a></h3>
<p>Note the tag name is configurable per policy configuration, examples below use
default tag name, ie. custodian_downtime.</p>
<ul class="simple">
<li>custodian_downtime:</li>
</ul>
<p>An empty tag value implies night and weekend offhours using the default
time zone configured in the policy (tz=est if unspecified).</p>
<ul class="simple">
<li>custodian_downtime: tz=pt</li>
</ul>
<p>Note all timezone aliases are referenced to a locality to ensure taking into
account local daylight savings time (if any).</p>
<ul class="simple">
<li>custodian_downtime: tz=Americas/Los_Angeles</li>
</ul>
<p>A geography can be specified but must be in the time zone database.</p>
<p>Per <a class="reference external" href="http://www.iana.org/time-zones">http://www.iana.org/time-zones</a></p>
<ul class="simple">
<li>custodian_downtime: off</li>
</ul>
<p>If offhours is configured to run in opt-out mode, this tag can be specified
to disable offhours on a given instance.</p>
</div>
<div class="section" id="policy-examples">
<h3>Policy examples<a class="headerlink" href="#policy-examples" title="Permalink to this headline">¶</a></h3>
<p>Turn ec2 instances on and off</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">policies</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">offhours-stop</span>
    <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">offhour</span>
    <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stop</span>

  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">offhours-start</span>
    <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">onhour</span>
    <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">start</span>
</pre></div>
</div>
<p>Here&#8217;s doing the same with auto scale groups</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">policies</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">asg-offhours-stop</span>
    <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">offhour</span>
    <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">suspend</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">asg-onhours-start</span>
    <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">onhour</span>
    <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">resume</span>
</pre></div>
</div>
</div>
<div class="section" id="options">
<h3>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>tag: the tag name to use when configuring</li>
<li>default_tz: the default timezone to use when interpreting offhours</li>
<li>offhour: the time to turn instances off, specified in 0-24</li>
<li>onhour: the time to turn instances on, specified in 0-24</li>
<li>opt-out: default behavior is opt in, as in <code class="docutils literal"><span class="pre">tag</span></code> must be present,
with opt-out: true, the tag doesn&#8217;t need to be present.</li>
</ul>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">policies</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">offhours-stop</span>
    <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">offhour</span>
        <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">downtime</span>
        <span class="l l-Scalar l-Scalar-Plain">onhour</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8</span>
        <span class="l l-Scalar l-Scalar-Plain">offhour</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="outputs">
<h2>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h2>
<p>Cloud Custodian generates a consistent set of outputs for any given
policy.</p>
<p>Custodian automatically generates per policy outputs with resources metrics
and archives serialization for all resources that match against a policy&#8217;s
filters.</p>
<div class="section" id="metrics">
<h3>Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h3>
<p>By default Cloud Custodian generates CloudWatch metrics on each policy for
the number of resources that matched the set of filters,
the time to retrieve and filter the resources, and the time to
execute actions.</p>
<p>In practice this number of matching resources allows for generating
enough metrics to put together useful dashboards over policies
in CloudWatch custom dashboards.</p>
<p>Additionally some filters and actions may generate their own metrics.</p>
<p>In order to enable metrics output, the boolean metrics
flag needs to be specified when running Cloud Custodian:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cloud-custodian run -c config.yml --metrics
</pre></div>
</div>
</div>
<div class="section" id="cloudwatch-logs">
<h3>CloudWatch Logs<a class="headerlink" href="#cloudwatch-logs" title="Permalink to this headline">¶</a></h3>
<p>Custodian can optionally upload its logs in realtime to CloudWatch logs, if
a log group is specified. Each policy&#8217;s log output is generated as a
separate stream.</p>
<p>Usage example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cloud-custodian run -c config.yml --log-group=/cloud-custodian/dev-account/us-east-1
</pre></div>
</div>
<p>If enabled, it is recommended to set a log subscription on the group to
be informed of an operations issue.</p>
<p>If S3 output is also enabled, then it is also recommended to set a log group
archival policy and to use the S3 logs as permanent/audit archive.</p>
</div>
<div class="section" id="s3-logs-records">
<h3>S3 Logs &amp; Records<a class="headerlink" href="#s3-logs-records" title="Permalink to this headline">¶</a></h3>
<p>Custodian will output its logs and structured resource records in JSON format to S3, along
with its log files for archival purposes.</p>
<p>The S3 bucket and prefix can be specified via parameters:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cloud-custodian run -c config.yml --output-dir s3://my-bucket/my/prefix
</pre></div>
</div>
<p>CSV reports can be generated with the <code class="docutils literal"><span class="pre">report</span></code> subcommand.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="resources/ami.html" class="btn btn-neutral float-right" title="Amazon Machine Images (AMI)" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="filters.html" class="btn btn-neutral" title="Value Filters" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Capital One Services, LLC.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>